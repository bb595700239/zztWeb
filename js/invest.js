function LinkProtemp(){window.open("/html/protem.html?subjectId="+$("#subjectId").val())}function getStatesFn(){$("#agree input").prop("checked")?getStatesFn.prototype.yz():$.confirm('<i class="i-icon3 i-round-warn"></i>请同意产品购买协议',[{yes:"知道了"}],function(t){"yes"==t&&this.hide()},{width:350})}function getAmountData(){var t=$("#subjectId").val();$.ajax({type:"get",url:url+"introduce/getReturn.action?subjectId="+t,dataType:"json",async:!1,success:function(t){setamount.data=t,$("#abolish").html($.outputmoney(t.abolish)),$("#investmentMoney").on("keyup blur",function(){setamount.init()});var e=$.getQueryString("fromMoney")||setamount.data.startingmark;setamount.init(e,!0),setamount.investFlag||setamount.init(setamount.data.startingmark,!0)}})}function goreSetPwd(){window.location.href="/html/resetPayPwd.html?fromurl="+location.href}$(document).ready(function(){var t=$("#sid").val();$.ajax({url:url+"introduce/simpleList/"+t,type:"get",success:function(t){$("#investToken").val(t.data.investToken),null==t.data.loginUser.userPaypwd||""==t.data.loginUser.userPaypwd?$("#goSetPwd").show().parent().addClass("goset"):($("#goreSetPwd").show().parent().addClass("goset"),$("#goSetPwd").hide()),$("#testTemplate").tmpl(t.data).appendTo("#tmpltest"),$("#myResidual").append(t.data.subject.strResidualMoney),getAmountData()}})}),getStatesFn.prototype.yz=function(){return validation.data.user?0==validation.data.user.userIsreal?void $.confirm('<i class="i-icon3 i-round-warn"></i>您需要进行实名认证后才可以继续投资',[{yes:"立即认证"},{no:"稍后认证"}],function(t){"yes"===t&&(location.href="/html/realName.html"),this.hide()},{width:400}):0==validation.data.user.userIsblankcard?void $.confirm('<i class="i-icon3 i-round-warn"></i>您需要绑定银行卡后才可以继续投资',[{yes:"立即绑定"},{no:"稍后绑定"}],function(t){"yes"===t&&(location.href="/html/bindCard.html"),this.hide()},{width:400}):validation.data.user.userRiskType?void getStatesFn.prototype.tj():void $.confirm('<i class="i-icon3 i-round-warn"></i>您需要风险评测后才可以继续投资',[{yes:"立即评估"},{no:"稍后评估"}],function(t){"yes"===t&&(location.href="/html/research.html?fromurl="+location.href),this.hide()},{width:400}):void(window.location.href="/html/login.html?fromurl="+location.href)},getStatesFn.prototype.tj=function(){function t(){a.removeClass("btns-disable").html(n)}obj=$("#paypwd");var e=obj.val(),a=$(".surebtn .btns"),n=a.html();$.ajax({type:"POST",url:url+"user/checkpayPsw",data:{PayPsw:e},beforeSend:function(){a.addClass("btns-disable").html("投资中...")},success:function(e){if("fail"==e.message)rule.erroralert(obj,"交易密码错误"),t();else{rule.success(obj);var a="";a="您已阅读和同意产品购买协议<br/>并将购买"+$(".name").text()+'产品，投资金额<span class="zzt-red">'+$.outputmoney($("#investmentMoney").val())+'</span>元，预期收益<span class="zzt-red">'+$("#shouyi").text()+"</span>元",$.confirm(a,[{yes:"确定"},{no:"取消"}],function(t,e){"yes"===t&&getStatesFn.prototype.fn(this,e),t&&this.hide()},{width:500,afterHide:function(){t()}})}},error:function(){$(".form-alert").html("系统繁忙，请稍后再试").show()}})},getStatesFn.prototype.fn=function(t,e){function a(){setTimeout(function(){n.removeClass("btns-disable").html(r).data("type","yes")},1e3)}var n=e.find(".ui-confirm-submit"),r=n.html();$.ajax({url:url+"investment/addInverstment",type:"post",data:$("#myform").serialize(),beforeSend:function(){n.addClass("btns-disable").html("提交中...").data("type","other")},success:function(e){a(),"ordererror"==e.message?($(".form-alert").html("请勿重复提交订单").show(),t.hide()):"pwderror"==e.message?(rule.erroralert($("#paypwd"),"交易密码错误"),t.hide()):"money"==e.message?(rule.erroralert($("#investmentMoney"),"余额不足"),t.hide()):"muchMoney"==e.message?(rule.erroralert($("#investmentMoney"),"超出最大投资金额"),t.hide()):"userLock"==e.message?($(".form-alert").html("您的账号已经被锁定，不能进行投标，请跟管理员联系！").show(),t.hide()):"subjectStateError"==e.message?($(".form-alert").html("借款标状态异常，不能进行投标！").show(),t.hide()):"availableLessMin"==e.message?($(".form-alert").html("可用余额小于最小投标金额！").show(),t.hide()):"investTooLittle"==e.message?($(".form-alert").html("投资金额必须大于0！").show(),t.hide()):"subjectFull"==e.message?($(".form-alert").html("此标已满！").show(),t.hide()):(rule.success($("#paypwd"),"密码正确"),window.location.href="/html/success/invesuccess.html")},error:function(){$(".form-alert").html("系统繁忙，请稍后再试").show(),a()}})};var setamount={investFlag:!1,init:function(t,e){var a=$("#investmentMoney");(t||0==t)&&a.val(t);var n=a.val(),r=0,s=0;if($("#upper").text(rule.digitUppercase(n)),$("#shouyi").text("0.00"),n<this.data.startingmark)return void(e?null:rule.erroralert(a,this.data.minMoney+"元起投"));if(n>this.data.residualMoney)return void(e?null:rule.erroralert(a,"超出剩余可投金额"));if(n>this.data.endingmark)return void(e?null:rule.erroralert(a,"最大投资额"+this.data.endingmark+"元"));if(r=this.getnianhua(this.data.type,n),s=n*r*.01*this.data.days/365,$("#shouyi").text($.outputmoney(s)),n>Number($("#tmpltest span").text().replace(/,/g,"")))return void(e?null:rule.erroralert(a,"余额不足"));var o=n-this.data.startingmark,i=o%this.data.abolish;return 0!=i?void(e?null:rule.erroralert(a,"请按递增金额投资")):void(e?this.investFlag=!0:rule.success(a))},getnianhua:function(t,e){var a=.06;return $.each(t,function(n){t[n].rangestart<=e&&e<=t[n].rangeend&&(a=t[n].income)}),a}};