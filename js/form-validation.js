var getcode={wait:60,ajax:function(e){var t=$("#phone"),a=t.val();t.triggerHandler("blur"),t.data("group-state")&&(this.time(e),$.ajax({url:url+e.data("url"),type:"post",dataType:"json",data:{phone:a},success:function(e){"success"==e.message||("antifail"==e.message?$(".form-alert").html("发送短信过多，请稍候重试").show():"toomuchfail"==e.message?$(".form-alert").html("1小时内同一手机号发送次数不能超过3次").show():$(".form-alert").html("短信发送失败，请稍候重试").show())},error:function(){$(".form-alert").html("网络连接失败").show()}}))},time:function(e){if(0==this.wait)e.removeClass("btns-disable"),e.text("获取验证码"),this.wait=60;else{e.addClass("btns-disable"),e.text("重新发送("+this.wait+")"),this.wait--;var t=this;setTimeout(function(){t.time(e)},1e3)}}};$(function(){$(".surebtn").on({click:function(){return $(".form-alert").hide(),rule.checkstate(),rule.allright?void("undefined"!=typeof getStatesFn?getStatesFn():rule.getStatesFn()):void 0}},'a:not(".btns-disable")'),$.enterSend({main:$(".form-box"),action:function(){$('.surebtn a:not(".btns-disable")').trigger("click")}}),$("#getcode").on({click:function(){getcode.ajax($(this))}},'a:not(".btns-disable")')});var rule={getStatesFn:function(){function e(){setTimeout(function(){r.removeClass("btns-disable").html(s)},1e3)}var t=$(".g-form"),a=$(".form-alert"),r=$(".surebtn .btns"),s=r.html(),i={dialogmes:null,gotourl:"/html/account/account.html#manage"},o=$.extend(i,{dialogmes:t.data("dialogmes"),gotourl:$.getQueryString("fromurl")||t.data("gotourl")});$.ajax({type:"POST",url:url+t.data("posturl"),data:t.serialize(),beforeSend:function(){r.addClass("btns-disable").html("提交中...")},success:function(t){if(e(),t.message=t.data||t.message,"success"==t.message){if(o.dialogmes)return void $.alert('<i class="i-icon3 i-round-right"></i>'+o.dialogmes,!0,function(){location.href=o.gotourl},5e3,{width:"390"});window.location.href=o.gotourl}else{var r;"code"==t.message?(r="图片验证码有误",rule.erroralert($("#"+t.message),r)):"telCode"==t.message?(r="短信验证码有误",rule.erroralert($("#"+t.message),r)):(a.html(t.message).show(),$("#getcodeJs").trigger("click"))}},error:function(){a.html("系统繁忙，请稍后再试").show(),e()}})},allright:!0,erroralert:function(e,t){var a=e.parent();e.data("group-state",!1),a.find(".group-tip").remove(),a.addClass("iserror").append('<div class="group-tip"><div class="con">'+t+'<div class="after"></div></div></div>'),setTimeout(function(){e.data("once5201314")?a.find(".group-tip").addClass("headShake animated"):e.data("once5201314",!0)},170)},success:function(e){e.data("group-state",!0),e.parent().removeClass("iserror").find(".group-tip").remove()},tip:function(e,t){if(""==e.val()){var a=e.parent();a.removeClass("iserror").find(".group-tip").remove(),a.append('<div class="group-tip" style="display:block"><div class="con">'+t+'<div class="after"></div></div></div>')}},checkstate:function(){rule.allright=!0,$.each($("*[data-group-state]"),function(){$(this).triggerHandler("blur"),$(this).data("group-state")||(rule.allright=!1)})},empty:function(e,t){var a=e.val().replace(/(^\s+)|(\s+$)/g,"");""==a?this.erroralert(e,t):this.success(e)},phone:function(e,t){var a=/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;a.test(e.val())?t?t(e):this.success(e):this.erroralert(e,"手机号格式不正确")},password:function(e,t){var a=/^[0-9a-zA-Z]{8,20}$/;a.test(e.val())?this.success(e):this.erroralert(e,"密码格式不正确"),t&&""!=t.val()&&t.triggerHandler("blur")},repassword:function(e,t){e.val()!=t.val()?this.erroralert(e,"两次密码不一致"):this.success(e)},tradingPassword:function(e,t,a){var r=/^[0-9]{6}$/;r.test(e.val())?a?a(e):this.success(e):this.erroralert(e,"交易密码格式不正确"),t&&""!=t.val()&&t.triggerHandler("blur")},idcard:function(e){var t=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;t.test(e.val())?this.success(e):this.erroralert(e,"身份证格式不正确")},bankcard:function(e){var t=/^(\d{16}|\d{19})$/;t.test(e.val().replace(/\s+/g,""))?this.success(e):this.erroralert(e,"银行卡格式不正确")},integer:function(e,t){e.val()>0?this.success(e):this.erroralert(e,t)},custom:function(obj,reg,mess,callback){var myReg=eval(reg);myReg.test(obj.val())?callback?callback(obj):this.success(obj):this.erroralert(obj,mess)},digitUppercase:function(e){var t="",a="仟佰拾亿仟佰拾万仟佰拾元角分";if(e){e+="00";var r=e.indexOf(".");r>=0&&(e=e.substring(0,r)+e.substr(r+1,2)),a=a.substr(a.length-e.length);for(var s=0;s<e.length;s++)t+="零壹贰叁肆伍陆柒捌玖".substr(e.substr(s,1),1)+a.substr(s,1);return t.replace(/零角零分$/,"整").replace(/零[仟佰拾]/g,"零").replace(/零{2,}/g,"零").replace(/零([亿|万])/g,"$1").replace(/零+元/,"元").replace(/亿零{0,3}万/,"亿").replace(/^元/,"零元")}return"-"}},JPlaceHolder={_check:function(){return"placeholder"in document.createElement("input")},init:function(){this._check()||this.fix()},fix:function(){jQuery(":input[placeholder]").each(function(){var e=$(this),t=e.attr("placeholder");e.wrap($("<div></div>").css({position:"relative",zoom:"1",border:"none",background:"none",padding:"none",margin:"none"}));var a=e.position(),r=e.outerHeight(!0),s=e.css("padding-left"),i=$("<span></span>").text(t).css({position:"absolute",left:a.left,top:a.top,height:r,lienHeight:r,paddingLeft:s,color:"#aaa"}).appendTo(e.parent());e.focusin(function(){i.hide()}).focusout(function(){e.val()||i.show()}),i.click(function(){i.hide(),e.focus()})})}};jQuery(function(){JPlaceHolder.init()});